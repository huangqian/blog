---
layout: post
title: 广告投放预估覆盖人群范围的方案
date: 2018-03-06 23:04:24
toc: true
tags: 
     - 广告
     - dsp
     - 算法
---

在广告投放系统和内容发布系统中，经常需要针对多个维度下，该内容能被下发到多少用户的预测。或者按照多个维度下进行预测可能有多少用户被分发。这个指标很重要，也是DSP中非常重要的一个功能。广告主在投放之前需要预测一下，他的广告能够覆盖到多少人群，这对于广告投放优化非常重要。

在广告的DMP平台中，存储的数据通常都是百亿、千亿甚至更多。如何在如此大的数据量中进行预估还能保证快速响应？是一个每一个DSP平台研发都遇到的难题。DSP平台的投放维度成百上千，如此多的维度，加上海量的数据，就算是今天也是严峻的挑战。impala、spark都是性能非常高，但是还是难以达到快速响应。而且这些方案通常需要消耗大量内存和cpu。在已有的成熟的数据仓库技术方案中，我想目前只有druid.io最接近，但是消耗的内存也不少。

有没有消耗内存很少又能快速的方案呢？

我想到了基于LogLogCount算法的HyperLogLog。假如一个DSP要实现基于`dim_A`, `dim_B`, `dim_C`, `dim_D`...等等维度进行覆盖人群数量估算。这里的方案是对于每一个维度的维度值构建一个HyperLogLog，比如有一个维度是城市，那么可以给各个城市分别构建一个HyperLogLog数据结构，比如北京一个HyperLogLog为HyperLogLog(北京)，上海的为HyperLogLog(上海)。